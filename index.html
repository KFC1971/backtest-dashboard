<!-- index.html (Self-Contained Version for Netlify) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Backtest Dashboard</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f9; color: #333; margin: 0; padding: 2em; }
        .container { max-width: 900px; margin: auto; background: white; padding: 2em; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        h1, h2 { color: #1a2b48; }
        h1 { border-bottom: 2px solid #eef; padding-bottom: 0.5em; }
        .controls { background: #f0f4f8; padding: 1em; border-radius: 4px; margin-bottom: 2em; display: flex; gap: 1em; align-items: center; }
        select { padding: 0.5em; border-radius: 4px; border: 1px solid #ccc; font-size: 1em; }
        table { width: 100%; border-collapse: collapse; margin-top: 1em; }
        th, td { text-align: left; padding: 0.8em; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; }
        tr:hover { background-color: #f1f1f1; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1em; }
        .metric-card { background: #f8f9fa; padding: 1em; border-radius: 4px; text-align: center; }
        .metric-card .value { font-size: 1.5em; font-weight: bold; color: #007bff; }
        .metric-card .label { font-size: 0.9em; color: #666; }
        .footer { text-align: center; margin-top: 2em; color: #888; font-size: 0.8em; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Live Backtest Performance Dashboard</h1>
        <h2>Dealer-Catalyst Momentum (Taiwan Market)</h2>

        <div class="controls">
            <label for="period-select"><strong>Select Period:</strong></label>
            <select id="period-select"></select>
        </div>

        <div id="dashboard-content">
            <!-- Content will be injected here by JavaScript -->
        </div>
    </div>
    
    <div class="footer">
        <p>Generated by Amalgam-7 Financial AGI</p>
    </div>

    <script>
        // Data is now embedded directly in the script
        const fullData = {
            "2023-Q1": {
                "metrics": {
                    "Quarterly Return": "+8.1%", "Profit/Loss": "+$25,110", "Win Rate": "75%",
                    "Number of Trades": "24", "Average Gain": "+4.2%", "Average Loss": "-2.9%"
                },
                "trades": [
                    {"id": "2330", "name": "台積電", "entry": "2023-01-10", "exit": "2023-02-05", "pl": "+12.3%", "trigger": "Dealer Accumulation"},
                    {"id": "2603", "name": "長榮", "entry": "2023-01-15", "exit": "2023-01-20", "pl": "-3.5%", "trigger": "Stop Loss Hit"},
                    {"id": "2454", "name": "聯發科", "entry": "2023-02-01", "exit": "2023-02-28", "pl": "+9.8%", "trigger": "Bullish Engulfing + BOP"},
                    {"id": "3443", "name": "創意", "entry": "2023-03-05", "exit": "2023-03-25", "pl": "+15.1%", "trigger": "Ex-Dividend Catalyst"}
                ]
            },
            "2022-Q4": {
                "metrics": {
                    "Quarterly Return": "+4.8%", "Profit/Loss": "+$15,230", "Win Rate": "68%",
                    "Number of Trades": "19", "Average Gain": "+3.1%", "Average Loss": "-2.4%"
                },
                "trades": [
                    {"id": "6411", "name": "晶焱", "entry": "2022-10-05", "exit": "2022-10-21", "pl": "+5.6%", "trigger": "Dealer Accumulation"},
                    {"id": "3035", "name": "智原", "entry": "2022-10-12", "exit": "2022-11-03", "pl": "+8.2%", "trigger": "Bullish Engulfing + BOP"},
                    {"id": "4966", "name": "譜瑞-KY", "entry": "2022-10-18", "exit": "2022-10-25", "pl": "-2.1%", "trigger": "Stop Loss Hit"},
                    {"id": "8069", "name": "元太", "entry": "2022-11-02", "exit": "2022-11-28", "pl": "+6.5%", "trigger": "Ex-Dividend Catalyst"}
                ]
            }
        };

        const periodSelect = document.getElementById('period-select');
        const dashboardContent = document.getElementById('dashboard-content');

        // 1. When the page loads, set up the dashboard
        document.addEventListener('DOMContentLoaded', () => {
            // Populate the dropdown selector
            Object.keys(fullData).forEach(period => {
                const option = document.createElement('option');
                option.value = period;
                option.textContent = period;
                periodSelect.appendChild(option);
            });

            // Load initial data for the first period in the list
            if (Object.keys(fullData).length > 0) {
                updateDashboard(Object.keys(fullData)[0]);
            }
        });

        // 2. Add event listener to update dashboard when selection changes
        periodSelect.addEventListener('change', (event) => {
            updateDashboard(event.target.value);
        });

        // 3. Function to render the data for the selected period
        function updateDashboard(period) {
            const periodData = fullData[period];
            if (!periodData) return;

            // Generate HTML for metrics
            let metricsHtml = '<h2>Performance Metrics</h2><div class="metrics-grid">';
            for (const [key, value] of Object.entries(periodData.metrics)) {
                metricsHtml += `
                    <div class="metric-card">
                        <div class="value">${value}</div>
                        <div class="label">${key}</div>
                    </div>
                `;
            }
            metricsHtml += '</div>';

            // Generate HTML for trades table
            let tradesHtml = '<h2>Trade Log</h2><table><tr><th>Stock ID</th><th>Name</th><th>Entry</th><th>Exit</th><th>P/L (%)</th><th>Trigger</th></tr>';
            periodData.trades.forEach(trade => {
                tradesHtml += `
                    <tr>
                        <td>${trade.id}</td>
                        <td>${trade.name}</td>
                        <td>${trade.entry}</td>
                        <td>${trade.exit}</td>
                        <td>${trade.pl}</td>
                        <td>${trade.trigger}</td>
                    </tr>
                `;
            });
            tradesHtml += '</table>';
            
            dashboardContent.innerHTML = metricsHtml + tradesHtml;
        }
    </script>

</body>
</html>